{"version":3,"sources":["../../../lib/queue/Node.ts"],"names":[],"mappings":"AAEA;;;GAGG;AACH,MAAM;IAIJ;;;;;OAKG;IACH,YAAY,MAA2B,EAAE,KAAa,EAAS,KAAgB;QAAhB,UAAK,GAAL,KAAK,CAAW;QAC7E,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;QAC1C,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;IAC/C,CAAC;IAED;;OAEG;IACH,aAAa;QACX,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;IACxD,CAAC;IAED;;;OAGG;IACH,KAAK;QACH,IAAI,CAAC;YACH,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;YACtD,MAAM,CAAC,IAAI,CAAC;QACd,CAAC;QAAC,KAAK,CAAA,CAAC,EAAE,CAAC,CAAC,CAAC;YACX,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;IACH,CAAC;IAED;;OAEG;IACH,MAAM;QACJ,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACrC,CAAC;IAED;;;;OAIG;IACH,MAAM,CAAC,SAAS,CAAC,MAA2B,EAAE,KAAa;QACzD,MAAM,CAAC,GAAG,MAAM,CAAC,SAAS,SAAS,KAAK,EAAE,CAAC;IAC7C,CAAC;IAED;;;;OAIG;IACH,MAAM,CAAC,gBAAgB,CAAY,MAA2B,EAAE,KAAa;QAC3E,IAAI,cAAc,GAAG,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;QACzE,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,cAAc,IAAI,IAAI,CAAC,CAAC;QACjD,MAAM,CAAC,IAAI,IAAI,CAAY,MAAM,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;IACnD,CAAC;CACF","file":"Node.js","sourceRoot":"","sourcesContent":["import {IQueueConfiguration} from './IQueueConfiguration';\n\n/**\n * Each node corresponds to an entry within the queue. This helps with\n * storage and removal from local storage.\n */\nexport class Node<ILogEntry> {\n  private _key: string;\n  private _serializedNode: string;\n\n  /**\n   * Constructs a node representing an entry in the queue.\n   * @param config The queue configuration. This is used to provide the prefix for the key.\n   * @param index The index within the queue\n   * @param value The value of the entry\n   */\n  constructor(config: IQueueConfiguration, index: number, public value: ILogEntry) {\n    this._key = Node.createKey(config, index);\n    this._serializedNode = JSON.stringify(value);\n  }\n\n  /**\n   * Returns an estimate of the size this will take up in local storage.\n   */\n  estimatedSize() {\n    return this._serializedNode.length + this._key.length;\n  }\n\n  /**\n   * Stores the serialized entry in local storage.\n   * @return {boolean} Success?\n   */\n  store() : boolean {\n    try {\n      localStorage.setItem(this._key, this._serializedNode);\n      return true;\n    } catch(ex) {\n      return false;\n    }\n  }\n\n  /**\n   * Removes the entry from local storage if it exists.\n   */\n  remove() {\n    localStorage.removeItem(this._key);\n  }\n\n  /**\n   * Creates a key for an entry.\n   * @param config The configuration containing the key prefix\n   * @param index The index of the entry in the queue\n   */\n  static createKey(config: IQueueConfiguration, index: number) {\n    return `${config.keyPrefix}-item-${index}`;\n  }\n\n  /**\n   * Loads an entry from local storage and deserializes it. Returns the associated node.\n   * @param config The configuration containing the key prefix\n   * @param index The index of the entry in the queue\n   */\n  static fromLocalStorage<ILogEntry>(config: IQueueConfiguration, index: number): Node<ILogEntry> {\n    let serializedNode = localStorage.getItem(Node.createKey(config, index));\n    const value = JSON.parse(serializedNode || '{}');\n    return new Node<ILogEntry>(config, index, value);\n  }\n}"]}