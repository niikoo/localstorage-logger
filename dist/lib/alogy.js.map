{"version":3,"file":"alogy.js","sourceRoot":"","sources":["../../lib/alogy.ts"],"names":[],"mappings":"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","sourcesContent":["import { ILogEntry } from './core/ILogEntry';\nimport { ConsoleLogger } from './loggers/ConsoleLogger';\nimport { DefaultFormatter } from './formatters/DefaultFormatter';\nimport { GoogleAnalyticsLogger } from './loggers/GoogleAnalyticsLogger';\nimport { ILocalStorageLoggerConfiguration } from './loggers/ILocalStorageLoggerConfiguration';\nimport { ILog } from './ILog';\nimport { IQueueConfiguration } from './queue/IQueueConfiguration';\nimport { LimitedSizeQueue } from './queue/LimitedSizeQueue';\nimport { LocalStorageLogger } from './loggers/LocalStorageLogger';\nimport { LogLevel } from './core/LogLevel';\nimport { NullLogger } from './loggers/NullLogger';\n\n// imports for this file only\nimport { Subject } from \"rxjs/Subject\";\n\nexport class Alogy {\n  private _alogy: ILog;\n  private formatter: DefaultFormatter;\n  private chainTerminal: NullLogger;\n  private consoleLogChain: ConsoleLogger;\n  private localStorageLogChain: LocalStorageLogger;\n  private googleAnalyticsLogChain: GoogleAnalyticsLogger;\n  /**\n   * New log entry event -> triggers on new logs\n   * @private\n   * @type {number}\n   * @memberof Alogy\n   */\n  public newLogEntry: Subject<ILogEntry> = new Subject<ILogEntry>();\n  private logGroupSize: number = 100; // Size of log group.Do not touch, unless you're know what you're doing. Default 100, that is for example 0- 99. With group 6, it's: 600-699\n  private _timestampProvider: () => Date = () => new Date;\n  /**\n   * Set up Alogy - Global config\n   *\n   * @param {AlogyLogDestination[]} [logTo=[AlogyLogDestination.LOCAL_STORAGE]] Set this to ´GOOGLE_ANALYTICS´ to have that as upper layer, if ´LOCAL_STORAGE´, analytics is not used.\n   * @param {ILocalStorageLoggerConfiguration} config Local storage config\n   * @memberof Alogy\n   */\n  create(\n    logTo: AlogyLogDestination = AlogyLogDestination.LOCAL_STORAGE,\n    config: ILocalStorageLoggerConfiguration\n  ){\n    this.formatter = new DefaultFormatter();\n    // Chain of responsibility style pattern here...\n    this.chainTerminal = new NullLogger();\n    this.consoleLogChain = new ConsoleLogger(this.formatter, this.chainTerminal);\n    this.localStorageLogChain = new LocalStorageLogger(config, this.consoleLogChain);\n    this.googleAnalyticsLogChain = new GoogleAnalyticsLogger(this.formatter, this.localStorageLogChain); //(config, this.localStorageLogChain);\n\n\n\n  }\n  /**\n   * Get the logging interface which can be used to log and also to devide logs by group or sender.\n   * @param {number} logGroup Log group ID. Select an integer\n   * @param {AlogyLogDestination} [logTo=AlogyLogDestination.LOCAL_STORAGE] Log destination\n   * @returns {LogAPI} The logging interface\n   * @memberof Alogy\n   */\n  getLogAPI(\n    logGroup: number,\n    logTo: AlogyLogDestination = AlogyLogDestination.LOCAL_STORAGE\n  ):LogAPI {\n    return new LogAPI(this, logTo, logGroup);\n  }\n\n  writeToLog(logTo: AlogyLogDestination, level: LogLevel, message: string, logGroup: number, code?: number) {\n    let time = this._timestampProvider().toISOString();\n    if(typeof code == 'undefined') {\n      code = this.stringToLogCode(message, logGroup, this.logGroupSize)\n    } else {\n      code = this.codeToGroup(code, logGroup, this.logGroupSize);\n    }\n    /*\n    * All logs trigger the newLogEntry event\n    */\n    this.newLogEntry.next((<ILogEntry>{\n      code: code,\n      message: message,\n      time: time,\n      level: level\n    }));\n\n    /**\n     * To outputs\n     */\n    switch (logTo) {\n      case AlogyLogDestination.GOOGLE_ANALYTICS:\n        console.error('not implemented yet'); /** @todo implement GOOGLE ANALYTICS LOGGING */\n        /*this.localStorageLogChain.log({\n          level, time, message: message\n        });*/\n        break;\n      case AlogyLogDestination.MEMORY:\n        this.consoleLogChain.log({\n          level, time, message, code\n        });\n        break;\n      case AlogyLogDestination.LOCAL_STORAGE:\n        this.localStorageLogChain.log({\n          level, time, message, code\n        });\n        break;\n    }\n  }\n\n  /**\n   * Returns an array with log entries formatted and returned as strings.\n   * @returns {string[]} String array of logs in Local Storage\n   * @memberof Alogy\n   */\n  exportToStringArray(): string[] {\n    return this.localStorageLogChain.allEntries().map(\n      entry => this.formatter.format(entry)\n    );\n  }\n\n  /**\n   * Returns an array with all <ILogEntry> in Local Storage\n   * @returns {Array<ILogEntry>} All log entries\n   * @memberof Alogy\n   */\n  exportToLogEntryArray(): Array<ILogEntry> {\n    return this.localStorageLogChain.allEntries();\n  }\n\n  /**\n   * Put log code into the log group.\n   * @param {number} code Log code\n   * @param {number} [logGroup=99] Log group\n   * @returns {number} Log code within group\n   * @memberof LogAPI\n   */\n  codeToGroup(code: number, logGroup: number = 99, logGroupSize: number = 100): number {\n    let min = logGroup * this.logGroupSize;\n    let max = min + (this.logGroupSize - 1);\n    return (((code < min || code > (min + (this.logGroupSize - 1))) ? this.stringToLogCode(code.toString()) : code));\n  }\n\n  /**\n   * Turn a string into a log code, if you don't know which to use or want it to be generated from the string\n   * @param {String} stc String to turn into a 'code', an number within the range of the logging group\n   * @param {number} [logGroup=99] Log group\n   * @returns {number} Log code within group\n   * @memberof LogAPI\n   */\n  stringToLogCode(stc: String, logGroup: number = 99, logGroupSize: number = 100): number {\n    let prep = 0, code = 0;\n    for (let i = 0; i < stc.length; i++) { prep += stc.charCodeAt(i); }\n    let min = logGroup * this.logGroupSize;\n    let fld = Math.floor((this.logGroupSize / prep) * this.logGroupSize);\n    code = parseInt(logGroup + ((fld < 10) ? '0' : '') + fld);\n    return (((code < min || code > (min + (this.logGroupSize - 1))) ? this.stringToLogCode(code.toString()) : code));\n  }\n}\n\nexport class LogAPI implements ILog {\n  /**\n   * Construct a new LogAPI instance\n   * @param _alogy A reference to the used Alogy instance\n   * @param logTo Log destination?\n   * @param logGroup Which log group\n   */\n  constructor(\n    private _alogy: Alogy,\n    private logTo: AlogyLogDestination = AlogyLogDestination.LOCAL_STORAGE,\n    private logGroup: number = 99\n  ) {\n  }\n  /**\n   * Log this debug message [level: debug]\n   *\n   * @param {string} message Debug message\n   * @param {number} [code] Log code (if empty: auto generated)\n   * @memberof LogAPI\n   */\n  debug(message: string, code ?: number) {\n    this._alogy.writeToLog(this.logTo, LogLevel.DEBUG, message, this.logGroup, code);\n  }\n  /**\n   * Log this info message [level: info]\n   *\n   * @param {string} message Info message\n   * @param {number} [code] Log code (if empty: auto generated)\n   * @memberof LogAPI\n   */\n\n  info(message: string, code ?: number) {\n    this._alogy.writeToLog(this.logTo, LogLevel.INFO, message, this.logGroup, code);\n  }\n  /**\n   * Log this warning message [level: warn]\n   *\n   * @param {string} message Warning message\n   * @param {number} [code] Log code (if empty: auto generated)\n   * @memberof LogAPI\n   */\n  warn(message: string, code ?: number) {\n    this._alogy.writeToLog(this.logTo, LogLevel.WARN, message, this.logGroup, code);\n  }\n  /**\n   * Log this error message [level: error]\n   *\n   * @param {string} message Error message\n   * @param {number} [code] Log code (if empty: auto generated)\n   * @memberof LogAPI\n   */\n  error(message: string, code ?: number) {\n    this._alogy.writeToLog(this.logTo, LogLevel.ERROR, message, this.logGroup, code);\n  }\n}\n\nexport enum AlogyLogDestination {\n  /**\n   * @description Only log to memory\n   */\n  MEMORY,\n  /**\n   * @description Log to local storage\n   */\n  LOCAL_STORAGE, // LS -> CONSOLE\n  /**\n   * @description Not implemented yet\n   * @ignore\n   */\n  GOOGLE_ANALYTICS // GA -> LS -> CONSOLE\n}\n"]}